-- Query: getPedidosPendientesPorColabor (NUEVA LÓGICA: Contar por ESTADO)
SELECT
    me.estado_interno AS estado_etapa, -- Usamos el nombre interno para el gráfico
    COUNT(p.id) AS order_count
FROM
    pedidos p
JOIN
    maestro_estados me ON p.estado_id = me.id
WHERE
    p.estado_id IN (1, 2) -- <--- FILTRAR SOLO ESTADOS 1 (pendiente_cotizacion) y 2 (cotizacion_enviada)
GROUP BY
    me.estado_interno
ORDER BY
    COUNT(p.id) DESC;